{% extends 'base.html' %}
{% block content %}
<h1 class="text-center mb-4">Settings</h1>
<h3>Update Your Passcode</h3>
<form method="POST">
    <input type="hidden" name="action" value="update_passcode">
    <div class="mb-3">
        <input type="password" name="new_passcode" class="form-control" placeholder="New 4-Digit Passcode" required maxlength="4">
    </div>
    <button type="submit" class="btn btn-primary btn-lg w-100">Update</button>
</form>
<h3 class="mt-4">Update Profile Picture</h3>
<form method="POST" enctype="multipart/form-data">
    <input type="hidden" name="action" value="update_pic">
    <div class="mb-3">
        <input type="file" name="profile_pic" class="form-control">
    </div>
    <button type="submit" class="btn btn-primary btn-lg w-100">Upload</button>
</form>
{% if is_parent %}
<h3 class="mt-4">Add User</h3>
<form method="POST" enctype="multipart/form-data">
    <input type="hidden" name="action" value="add_user">
    <div class="mb-3">
        <label>Name</label>
        <input type="text" name="name" class="form-control" required>
    </div>
    <div class="mb-3">
        <label>Type</label>
        <select name="type" class="form-control">
            <option value="parent">Parent</option>
            <option value="kid">Kid</option>
        </select>
    </div>
    <div class="mb-3">
        <label>4-Digit Passcode</label>
        <input type="password" name="passcode" class="form-control" required maxlength="4">
    </div>
    <div class="mb-3">
        <label>Profile Picture</label>
        <input type="file" name="profile_pic" class="form-control">
    </div>
    <button type="submit" class="btn btn-primary btn-lg w-100">Add User</button>
</form>
<h3 class="mt-4">Manage Users</h3>
{% for user in users %}
<div class="card mb-3">
    <div class="card-body d-flex justify-content-between align-items-center">
        <h5>{{ user.name }} ({{ user.type.capitalize() }})</h5>
        <form method="POST" style="display:inline;">
            <input type="hidden" name="action" value="delete_user">
            <input type="hidden" name="target_id" value="{{ user.id }}">
            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this user?');">Delete</button>
        </form>
    </div>
</div>
{% endfor %}
<h3 class="mt-4">Reset Passcode for Others</h3>
{% for user in users %}
<div class="card mb-3">
    <div class="card-body">
        <h5>{{ user.name }} ({{ user.type.capitalize() }})</h5>
        <form method="POST">
            <input type="hidden" name="action" value="reset_passcode">
            <input type="hidden" name="target_id" value="{{ user.id }}">
            <div class="mb-3">
                <input type="password" name="new_passcode" class="form-control" placeholder="New 4-Digit Passcode" required maxlength="4">
            </div>
            <button type="submit" class="btn btn-warning btn-sm w-100">Reset</button>
        </form>
    </div>
</div>
{% endfor %}
<h3 class="mt-4">Manage Tasks</h3>
<form method="POST">
    <input type="hidden" name="action" value="add_task">
    <div class="mb-3">
        <label>Task Name</label>
        <input type="text" name="task_name" class="form-control" required>
    </div>
    <div class="mb-3">
        <label>Category</label>
        <select name="category" class="form-control">
            <option value="morning">Morning</option>
            <option value="evening">Evening</option>
            <option value="night">Night</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary btn-lg w-100">Add Task</button>
</form>
<ul class="list-group mt-3">
    {% for task in tasks %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
        {{ task.name }} ({{ task.category.capitalize() }})
        <div>
            <form method="POST" style="display:inline;">
                <input type="hidden" name="action" value="move_task_up">
                <input type="hidden" name="task_id" value="{{ task.id }}">
                <button type="submit" class="btn btn-outline-secondary btn-sm">↑</button>
            </form>
            <form method="POST" style="display:inline;">
                <input type="hidden" name="action" value="move_task_down">
                <input type="hidden" name="task_id" value="{{ task.id }}">
                <button type="submit" class="btn btn-outline-secondary btn-sm">↓</button>
            </form>
            <form method="POST" style="display:inline;">
                <input type="hidden" name="action" value="delete_task">
                <input type="hidden" name="task_id" value="{{ task.id }}">
                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this task?');">Delete</button>
            </form>
        </div>
    </li>
    {% endfor %}
</ul>
{% endif %}
<a href="{{ url_for('home') if session.type == 'kid' else url_for('kids') }}" class="btn btn-secondary btn-lg w-100 mt-4">Back</a>
{% endblock %}