{% extends 'base.html' %}
{% block content %}
<h1>Settings</h1>

<h3>Update Profile Picture</h3>
<form action="{{ url_for('upload_pic') }}" method="post" enctype="multipart/form-data">
    <input type="file" name="file" accept="image/*">
    <button type="submit">Upload</button>
</form>
<img src="{{ url_for('static', filename='uploads/' + session.user_id|string + '.png') if session.profile_pic else url_for('static', filename='default.png') }}" alt="Profile Picture" width="100">

{% if is_parent %}
<h3>Manage Users</h3>
<form action="{{ url_for('add_user') }}" method="post">
    <input type="text" name="name" placeholder="Name" required>
    <input type="password" name="passcode" placeholder="Passcode (4 digits)" pattern="\d{4}" required>
    <select name="type">
        <option value="parent">Parent</option>
        <option value="kid">Kid</option>
    </select>
    <button type="submit">Add User</button>
</form>
<table>
    {% for user in users %}
    <tr>
        <td>
            <h5>{{ user.name }} ({{ user.type.capitalize() }})</h5>
        </td>
        <td>
            <form action="{{ url_for('delete_user') }}" method="post" style="display:inline;">
                <input type="hidden" name="user_id" value="{{ user.id }}">
                <button type="submit" onclick="return confirm('Are you sure?');">Delete</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>

<h3>Reset Passcode for Others</h3>
{% for user in users %}
{% if user.id != session.user_id %}
<h5>{{ user.name }} ({{ user.type.capitalize() }})</h5>
<form action="{{ url_for('reset_passcode') }}" method="post">
    <input type="hidden" name="user_id" value="{{ user.id }}">
    <input type="password" name="new_passcode" placeholder="New Passcode (4 digits)" pattern="\d{4}" required>
    <button type="submit">Reset</button>
</form>
{% endif %}
{% endfor %}

<h3>Manage Tasks</h3>
<form action="{{ url_for('add_task') }}" method="post">
    <input type="text" name="name" placeholder="Task Name" required>
    <select name="category">
        <option value="morning">Morning</option>
        <option value="evening">Evening</option>
        <option value="night">Night</option>
    </select>
    <button type="submit">Add Task</button>
</form>
<table>
    {% for task in tasks %}
    <tr>
        <td>
            <span id="task-name-{{ task.id }}">{{ task.name }}</span> ({{ task.category.capitalize() }})
        </td>
        <td>
            <button class="edit-btn" onclick="editTask({{ task.id }})">Edit</button>
        </td>
        <td>
            <form action="{{ url_for('delete_task') }}" method="post" style="display:inline;">
                <input type="hidden" name="task_id" value="{{ task.id }}">
                <button type="submit" onclick="return confirm('Are you sure?');">Delete</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>
{% endif %}

<h3>Update Your Passcode</h3>
<form action="{{ url_for('update_passcode') }}" method="post">
    <input type="password" name="old_passcode" placeholder="Old Passcode" pattern="\d{4}" required>
    <input type="password" name="new_passcode" placeholder="New Passcode (4 digits)" pattern="\d{4}" required>
    <button type="submit">Update</button>
</form>

<a href="{{ url_for('home') if session.type == 'kid' else url_for('kids') }}">Back</a>
{% endblock %}
